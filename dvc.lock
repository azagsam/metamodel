schema: '2.0'
stages:
  prepare-data-d2v:
    cmd: python src/get_data.py --model d2v
    deps:
    - path: /home/azagar/myfiles/kas_final/final/kas.corpus/kas.txt
      md5: 3d102d621b7d5fdc4edcb02b9a362a7d.dir
      size: 9026132440
      nfiles: 82308
    - path: /home/azagar/myfiles/t5/data/asn-summary-plus-sta-lead
      md5: 51efe69580dffb11ae0df22f04e5c46c.dir
      size: 1484937476
      nfiles: 3
    - path: data/surs.jsonl
      md5: 8a2b6edaffd6ff94fde2eed5dd917ca8
      size: 8947469
    outs:
    - path: data/doc2vec-training.jsonl
      md5: 6f23f068915b24923ad6051f58e987fb
      size: 7956779558
  prepare-data-metamodel:
    cmd: python src/get_data.py --model metamodel
    deps:
    - path: /home/azagar/myfiles/kas_final/final/kas.abstracts
      md5: 505422d80d54a10b17099888c8a3a8e4.dir
      size: 225029331
      nfiles: 125203
    - path: /home/azagar/myfiles/kas_final/final/kas.corpus/kas.txt
      md5: 3d102d621b7d5fdc4edcb02b9a362a7d.dir
      size: 9026132440
      nfiles: 82308
    - path: /home/azagar/myfiles/t5/data/asn-summary-plus-sta-lead
      md5: 51efe69580dffb11ae0df22f04e5c46c.dir
      size: 1484937476
      nfiles: 3
    - path: data/surs.jsonl
      md5: 8a2b6edaffd6ff94fde2eed5dd917ca8
      size: 8947469
    outs:
    - path: data/metamodel-training.jsonl
      md5: c2d0652ad342627e95f23768d1bc942a
      size: 8857204468
  train-d2v:
    cmd: python src/train_doc2vec.py data/doc2vec-training.jsonl model/doc2vec-large
    deps:
    - path: data/doc2vec-training.jsonl
      md5: 6f23f068915b24923ad6051f58e987fb
      size: 7956779558
    - path: src/train_doc2vec.py
      md5: ef4619555f1c53226c76179ce0c235ec
      size: 1718
    params:
      params.yaml:
        train-d2v.epochs: 5
        train-d2v.max_vocab_size: 100000
        train-d2v.min_count: 1
        train-d2v.vector_size: 256
        train-d2v.window: 5
        train-d2v.workers: 16
    outs:
    - path: d2v-metrics.json
      md5: 395c10af666a6d926961450b5f9afb2b
      size: 13
    - path: model/doc2vec-large
      md5: 622a7f5307adee452103394d67eda04e
      size: 5433532
  train-metamodel:
    cmd: python src/train_metamodel.py data/metamodel-training-with-scores.jsonl model/model-large/embeddings.npy
      model/metamodel-master/model.h5
    deps:
    - path: data/metamodel-training-with-scores.jsonl
      md5: b2ceeff6147ea59268dab9b69a9189b5
      size: 302424465
    - path: model/model-large/embeddings.npy
      md5: 8f05310c4294891aaac37b642ad58e5b
      size: 9216128
    - path: src/train_metamodel.py
      md5: c38556b65063cf6ff6fb1654f576b602
      size: 2189
    params:
      params.yaml:
        train-metamodel.seed: 100
        train-metamodel.validation_split: 0.1
    outs:
    - path: advanced-metrics.json
      md5: cde25e035059402856be3b9a6cffb4e1
      size: 89
    - path: model/metamodel-master/model.h5
      md5: cca4ac34c669c40e884818d7f535fead
      size: 8456352
  prepare-embeddings:
    cmd: python src/prepare_embeddings.py data/final model/doc2vec/model model/doc2vec/final
    deps:
    - path: data/final
      md5: 652afbd048dd642738d800d7a05adf10.dir
      size: 2546864828
      nfiles: 4
    - path: model/doc2vec/model
      md5: 34afba3ae0923d1408298d9d29972266
      size: 5433533
    - path: src/prepare_embeddings.py
      md5: 2025963650b0e7477e8b6e92b0a8133d
      size: 1866
    outs:
    - path: model/doc2vec/final
      md5: 9848e2d286152bbdd7a0b9f3c34ad07d.dir
      size: 112999936
      nfiles: 4
  random-baseline:
    cmd: python src/random_baseline.py data/final/train.jsonl data/final/test.jsonl
    deps:
    - path: data/final/test.jsonl
      md5: d7cc644ae061295194f180a075ee9e86
      size: 71993789
    - path: data/final/train.jsonl
      md5: 062198cc3ab761a754444992bf2e6056
      size: 1387795638
    - path: src/random_baseline.py
      md5: e5bbd5b816ce697f4038c9164b510c9b
      size: 847
    outs:
    - path: baseline-metrics.json
      md5: 0ca0cbb45e90fc57ce791c0f8d485491
      size: 31
  metamodel:
    cmd: python src/train_metamodel.py data/final model/doc2vec/final model/metamodel/model.h5
    deps:
    - path: data/final
      md5: 652afbd048dd642738d800d7a05adf10.dir
      size: 2546864828
      nfiles: 4
    - path: model/doc2vec/final
      md5: 9848e2d286152bbdd7a0b9f3c34ad07d.dir
      size: 112999936
      nfiles: 4
    - path: src/train_metamodel.py
      md5: e10a653d16af921b4b5812fbcbeef001
      size: 2652
    params:
      params.yaml:
        metamodel.hidden_layer_size: 1024
        metamodel.patience: 2
        metamodel.seed: 10
        metamodel.validation_split: 0.1
    outs:
    - path: advanced-metrics.json
      md5: 7587cfa9d6fd1fa7ea36701c32a8f0f2
      size: 87
    - path: model/metamodel/model.h5
      md5: 314a32bf7af1d5b14fb8a76ac024d3b1
      size: 15982752
  d2v:
    cmd: python src/train_doc2vec.py data/doc2vec-training.jsonl model/doc2vec/model
    deps:
    - path: data/doc2vec-training.jsonl
      md5: 6f23f068915b24923ad6051f58e987fb
      size: 7956779558
    - path: src/train_doc2vec.py
      md5: 069f0d64dda2842a293414ecfecbe4da
      size: 1614
    params:
      params.yaml:
        d2v.epochs: 5
        d2v.max_vocab_size: 100000
        d2v.min_count: 1
        d2v.vector_size: 256
        d2v.window: 5
        d2v.workers: 16
    outs:
    - path: model/doc2vec/model
      md5: 34afba3ae0923d1408298d9d29972266
      size: 5433533
  trees:
    cmd: python src/train_trees.py data/final model/doc2vec/final
    deps:
    - path: data/final
      md5: 652afbd048dd642738d800d7a05adf10.dir
      size: 2546864828
      nfiles: 4
    - path: model/doc2vec/final
      md5: 9848e2d286152bbdd7a0b9f3c34ad07d.dir
      size: 112999936
      nfiles: 4
    - path: src/train_trees.py
      md5: 44f5619c687347c11f05330162cf73e9
      size: 2883
    outs:
    - path: forest-metrics.json
      md5: afa9443dc3117222b1cc349ae6dbfa68
      size: 31
    - path: tree-metrics.json
      md5: 02e40becbfabbcca3fa7e0bca8cbfb39
      size: 31
