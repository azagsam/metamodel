schema: '2.0'
stages:
  prepare-data-d2v:
    cmd: python src/get_data.py --model d2v
    deps:
    - path: /home/azagar/myfiles/kas_final/final/kas.corpus/kas.txt
      md5: 3d102d621b7d5fdc4edcb02b9a362a7d.dir
      size: 9026132440
      nfiles: 82308
    - path: /home/azagar/myfiles/t5/data/asn-summary-plus-sta-lead
      md5: 51efe69580dffb11ae0df22f04e5c46c.dir
      size: 1484937476
      nfiles: 3
    - path: data/surs.jsonl
      md5: 8a2b6edaffd6ff94fde2eed5dd917ca8
      size: 8947469
    outs:
    - path: data/doc2vec-training.jsonl
      md5: 6f23f068915b24923ad6051f58e987fb
      size: 7956779558
  prepare-data-metamodel:
    cmd: python src/get_data.py --model metamodel
    deps:
    - path: /home/azagar/myfiles/kas_final/final/kas.abstracts
      md5: 505422d80d54a10b17099888c8a3a8e4.dir
      size: 225029331
      nfiles: 125203
    - path: /home/azagar/myfiles/kas_final/final/kas.corpus/kas.txt
      md5: 3d102d621b7d5fdc4edcb02b9a362a7d.dir
      size: 9026132440
      nfiles: 82308
    - path: /home/azagar/myfiles/t5/data/asn-summary-plus-sta-lead
      md5: 51efe69580dffb11ae0df22f04e5c46c.dir
      size: 1484937476
      nfiles: 3
    - path: data/surs.jsonl
      md5: 8a2b6edaffd6ff94fde2eed5dd917ca8
      size: 8947469
    outs:
    - path: data/metamodel-training.jsonl
      md5: c2d0652ad342627e95f23768d1bc942a
      size: 8857204468
  train-d2v:
    cmd: python src/train_doc2vec.py /home/azagar/myfiles/metamodel/data/doc2vec-training.jsonl
      /home/azagar/myfiles/metamodel/model/doc2vec-large
    deps:
    - path: data/doc2vec-training.jsonl
      md5: 6f23f068915b24923ad6051f58e987fb
      size: 7956779558
    - path: src/train_doc2vec.py
      md5: ef4619555f1c53226c76179ce0c235ec
      size: 1718
    params:
      params.yaml:
        train-d2v.epochs: 5
        train-d2v.max_vocab_size: 100000
        train-d2v.min_count: 1
        train-d2v.vector_size: 256
        train-d2v.window: 5
        train-d2v.workers: 16
    outs:
    - path: d2v-metrics.json
      md5: 395c10af666a6d926961450b5f9afb2b
      size: 13
    - path: model/doc2vec-large
      md5: 5bfae20d9d9ecb825f4e22dc6530b6b9
      size: 5433563
  train-metamodel:
    cmd: python src/train_metamodel.py /home/azagar/myfiles/metamodel/data/metamodel-training-with-scores-sample.jsonl
      /home/azagar/myfiles/metamodel/model/model-large/embeddings-sample.npy /home/azagar/myfiles/metamodel/model/metamodel-master/model.h5
    deps:
    - path: data/metamodel-training-with-scores-sample.jsonl
      md5: ecfa1fd4729bbd34634fa1a4e2a97fc7
      size: 15300188
    - path: model/model-large/metamodel
      md5: 20669f7e5c47c4ec232bd8bac0a06f02
      size: 181210488
    - path: src/train_metamodel.py
      md5: 7a120144db0279272c5b4e3a0a2daac0
      size: 1860
    params:
      params.yaml:
        train-metamodel.seed: 46
        train-metamodel.validation_split: 0.2
    outs:
    - path: metamodel-metrics.json
      md5: ae31a25e7df84080e8b8cbd34961ca9b
      size: 59
    - path: model/metamodel-master/model.h5
      md5: b2be03e64a5b99a0a5907fdb1996d2ca
      size: 4076312
  prepare-embeddings:
    cmd: python src/prepare_embeddings.py /home/azagar/myfiles/metamodel/data/metamodel-training-with-scores-sample.jsonl
      /home/azagar/myfiles/metamodel/model/model-large/metamodel /home/azagar/myfiles/metamodel/model/model-large/embeddings-sample.npy
    deps:
    - path: data/metamodel-training-with-scores-sample.jsonl
      md5: ecfa1fd4729bbd34634fa1a4e2a97fc7
      size: 15300188
    - path: model/model-large/metamodel
      md5: 20669f7e5c47c4ec232bd8bac0a06f02
      size: 181210488
    - path: src/prepare_embeddings.py
      md5: c423b0ca928152f3ebe82195aa51400c
      size: 1594
    outs:
    - path: model/model-large/embeddings-sample.npy
      md5: d1f9895f68c3090c96c2317ea9bf5e68
      size: 512128
